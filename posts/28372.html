<!DOCTYPE html><html lang="cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Java 加密与解密的艺术 | Daisy's Blog</title><meta name="author" content="Daisy"><meta name="copyright" content="Daisy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 企业应用安全安全技术目标  保密性 Confidentiality  完整性 Integrity  可用性 Availability  可靠性 Reliability  抗否认性 Non-Repudiation  可控性  可审查性  认证（鉴别）  访问控制   五类安全服务  认证鉴别服务"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://starskydata.com/posts/28372.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="sDPUs3nTAhgMGYrvOmlNqi1vDLQTcKL1X6tCvY_f3ns"/><meta name="baidu-site-verification" content="code-EWEBQNmKjY"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java 加密与解密的艺术',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-12-21 15:43:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/pink.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Daisy's Blog"><span class="site-name">Daisy's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java 加密与解密的艺术</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-12-20T20:00:00.000Z" title="Created 2022-12-21 00:00:00">2022-12-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java%E5%9F%BA%E7%A1%80/">java基础</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Java 加密与解密的艺术"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-企业应用安全"><a href="#1-企业应用安全" class="headerlink" title="1. 企业应用安全"></a>1. 企业应用安全</h1><p>安全技术目标</p>
<ul>
<li><p>保密性 Confidentiality</p>
</li>
<li><p>完整性 Integrity</p>
</li>
<li><p>可用性 Availability</p>
</li>
<li><p>可靠性 Reliability</p>
</li>
<li><p>抗否认性 Non-Repudiation</p>
</li>
<li><p>可控性</p>
</li>
<li><p>可审查性</p>
</li>
<li><p>认证（鉴别）</p>
</li>
<li><p>访问控制</p>
</li>
</ul>
<p>五类安全服务</p>
<ul>
<li><p>认证鉴别服务，网络交互中，验证收发双方的身份和数据来源</p>
</li>
<li><p>访问控制服务，防止未授权用户非法访问资源，包括用户身份和权限确认</p>
</li>
<li><p>数据保密性服务，防止数据在传输过程中被破解、泄漏</p>
</li>
<li><p>数据完整性服务，防止数据在传输过程中被篡改</p>
</li>
<li><p>抗否认性服务，防止收发双方在执行格子操作后，否认所做的操作</p>
</li>
</ul>
<p>八类安全机制</p>
<p><img src="../../images/image-20210810171117799.png" alt="image-20210810171117799" style="zoom:200%;" /></p>
<p>TCP/IP从字面上看是两个Internet上的网络协议（TCP是传输控制协议，IP是网际协议），但实际上TCP/IP是一组网络协议，通常包括TCP、IP、UDP、ICMP、RIP、TELNET、FTP、SMTP、ARP、TFTP等协议。TCP/IP参考模型由下至上分为网络接口层、网络层、传输层和应用层。</p>
<p><img src="../../images/image-20210810171147221.png" alt="image-20210810171147221" style="zoom:200%;" /></p>
<p>WTLS协议（Wireless Transport Layer Security）,无线传输层安全</p>
<h1 id="2-密码学"><a href="#2-密码学" class="headerlink" title="2. 密码学"></a>2. 密码学</h1><p>密码学在加密算法上大体可分为单向加密算法、对称加密算法、非对称加密算法三大类。</p>
<ul>
<li><p>MD5、SHA算法是单向加密算法的代表，单向加密算法是数据完整性验证的常用算法。</p>
</li>
<li><p>DES算法是对称加密算法的典型代表，对称加密算法是数据存储加密的常用算法。</p>
</li>
<li><p>RSA算法是非对称加密算法的典型代表。非对称加密算法是数据传输加密的常用算法。</p>
</li>
<li><p>相对对称加密算法而言，非对称加密算法在安全级别上等级更高，但非对称加密算法在时间效率上远不如对称加密算法。</p>
</li>
</ul>
<p>密码学历史大体分为三个阶段，手工加密阶段、机械加密阶段和计算机加密阶段。</p>
<p>密码体制（Cipher System）：由明文空间、密文空间、密钥空间、加密算法和解密算法五部分构成</p>
<p>柯克霍夫原则：数据的安全基于密钥而不是算法的保密，系统的安全性取决于密钥，对密钥保密，对算法公开。</p>
<h2 id="密码学分类"><a href="#密码学分类" class="headerlink" title="密码学分类"></a><strong>密码学分类</strong></h2><p>从时间上，密码学可以分为古典密码学和现代密码学</p>
<p>按保密内容的算法划分，受限制算法密码学和基于密钥算法密码学</p>
<p>按密码体制，分为对称密码体制密码学和非对称密码体制密码学。</p>
<p>按明文的处理方法，分为分组密码学和流密码学</p>
<h2 id="各种密码学"><a href="#各种密码学" class="headerlink" title="各种密码学"></a><strong>各种密码学</strong></h2><ul>
<li><p>古典密码：移位和替代</p>
</li>
<li><p>对称密码体制</p>
</li>
</ul>
<p>对称密码体制分为两种：一种是对明文的单个位（或字节）进行加密和解密，称为流密码，又称为序列密码；另一种是把明文信息划分成不同的组（或块）结构，分别对每个组（或块）进行加密和解密，称为分组密码</p>
<ul>
<li><p>非对称密码体制</p>
</li>
<li><p>散列函数</p>
</li>
<li><p>数字签名</p>
</li>
</ul>
<p>完整性、可认证性和不可否认性，正是数字签名的主要特征。</p>
<ul>
<li>公钥基础设施</li>
</ul>
<p>PKI系统由认证中心（Certificate Authority，CA）、数字证书库（Certificate Repository, CR）、密钥备份及恢复系统、证书作废系统，以及应用程序接口（Application Programming Interface，API）五部分组成。其中，认证中心CA和数字证书库是PKI技术的核心</p>
<ul>
<li>PGP、OpenPGP、GPG</li>
</ul>
<h1 id="3-java加密"><a href="#3-java加密" class="headerlink" title="3. java加密"></a>3. java加密</h1><p>Java安全领域总共分为4个部分：</p>
<ul>
<li>JCA（Java CryptographyArchitecture，Java加密体系结构</li>
<li>JCE（Java CryptographyExtension，Java加密扩展包）</li>
<li>JSSE（Java Secure SocketsExtension, Java安全套接字扩展包）</li>
<li>JAAS（Java Authentication andAuthentication Service，Java鉴别与安全服务）<h2 id="java-security包"><a href="#java-security包" class="headerlink" title="java.security包"></a>java.security包</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Provider p : Security.getProviders())&#123;</span><br><span class="line">  System.out.println(p);</span><br><span class="line">  <span class="keyword">for</span>(Map.Entry&lt;Object,Object&gt; entry:p.entrySet())&#123;</span><br><span class="line">  	System.out.println(<span class="string">&quot;\t&quot;</span>+entry.getKey());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
使用apache commons codec做常用加密解密<br>SecretKey、PublicKey、PrivateKey三大接口继承于Key接口，定义了对称密钥和非对称密钥接口<h2 id="java-crypto包"><a href="#java-crypto包" class="headerlink" title="java.crypto包"></a>java.crypto包</h2><h2 id="java-security-spec包和javax-crypto-spec包"><a href="#java-security-spec包和javax-crypto-spec包" class="headerlink" title="java.security.spec包和javax.crypto.spec包"></a>java.security.spec包和javax.crypto.spec包</h2><h2 id="java-security-cert包"><a href="#java-security-cert包" class="headerlink" title="java.security.cert包"></a>java.security.cert包</h2><h2 id="javax-net-ssl包"><a href="#javax-net-ssl包" class="headerlink" title="javax.net.ssl包"></a>javax.net.ssl包</h2></li>
</ul>
<h1 id="4-辅助工具"><a href="#4-辅助工具" class="headerlink" title="4. 辅助工具"></a>4. 辅助工具</h1><p>加密组件Bouncy Castle</p>
<p>辅助工具Commons Codec</p>
<h1 id="5-Base64-电子邮件传输算法"><a href="#5-Base64-电子邮件传输算法" class="headerlink" title="5. Base64-电子邮件传输算法"></a>5. Base64-电子邮件传输算法</h1><p><img src="../../images/image-20221221104004083.png" alt=""></p>
<p>编码 </p>
<ul>
<li><p>字符串,以字符为单位 -&gt; 对应的字符编码（如ASCII码）。 </p>
</li>
<li><p>字符编码 -&gt; 二进制码。 </p>
</li>
<li><p>二进制码做分组转换，每3个8位二进制码为一组，转换为每4个6位二进制码为一组（不足6位时低位补0）。这是一个分组变化的过程，3个8位二进制码和4个6位二进制码的长度都是24位（3×8=4×6=24）。 </p>
</li>
<li><p>对获得的4个6位二进制码补位，向6位二进制码添加2位高位0，组成4个8位二进制码。 </p>
</li>
<li><p>将获得的4个8位二进制码转换为十进制码。 </p>
</li>
<li><p>将获得的十进制码转换为Base64字符表中对应的字符。 </p>
</li>
<li><p>当原文的二进制码长度不足24位，最终转换为十进制码时也不足4项，这时就需要用等号补位 </p>
</li>
</ul>
<p><img src="../../images/image-20221221104044522.png" alt=""></p>
<p>Bouncy Castle和Commons Codec都提供了Base64算法实现，但是否遵循RFC 2045定义，即在编码后的字符串末尾是否添加回车换行符，是两种实现的唯一差别！ </p>
<p>Bouncy Castle遵循了一般Base64算法编码。 </p>
<p>Commons Codec提供了Base64算法的两种实现标准：一种是遵循一般Base64算法实现；另一种是遵循RFC 2045定义。此外，CommonsCodec还提供了Base64算法的定制实现，可以自定每行字符数和行末符号。同时，Commons Codec还提供了基于Base64算法的输入输出流实现。 </p>
<p>综上所述，单纯的Base64算法在使用上比Commons Codec更具优势。 </p>
<p>Apache的CommonCodec是我们最好的选择！ </p>
<h1 id="6-消息摘要算法——验证数据完整性"><a href="#6-消息摘要算法——验证数据完整性" class="headerlink" title="6. 消息摘要算法——验证数据完整性"></a>6. 消息摘要算法——<strong>验证数据完整性</strong></h1><p>三大类：MD（Message Digest，消息摘要算法）、SHA-1（SecureHash Algorithm，安全散列算法）和HmacMD5（Message Authentication Code，消息认证码算法）。 </p>
<p>MD系列算法包括MD2、MD4和MD5共3种算法；SHA算法主要包括其代表算法SHA-1和SHA-1算法的变种SHA-2系列算法（包含SHA-224、SHA-256、SHA-384和SHA-512）；MAC算法综合了上述两种算法，主要包括HmacMD5、HmacSHA1、HmacSHA256、HmacSHA384和HmacSHA512算法。 </p>
<p>RipeMD系列（包含RipeMD128、RipeMD160、RipeMD256、RipeMD320）、Tiger、GOST3411和Whirlpool算法 </p>
<p>循环冗余校验算法—CRC算法Cyclic Redundancy Check </p>
<p><img src="../../images/image-20221221104126787.png" alt=""></p>
<h1 id="7-对称加密算法——初等数据加密"><a href="#7-对称加密算法——初等数据加密" class="headerlink" title="7. 对称加密算法——初等数据加密"></a>7. <strong>对称加密算法——初等数据加密</strong></h1><p>在对称加密算法中，DES算法最具有代表性，堪称典范；DESede是DES算法的变种；AES算法则作为DES算法的替代者；而IDEA算法作为一种强加密算法，成为电子邮件加密软件PGP（Pretty Good Privacy）的核心算法之一。 </p>
<p>一般密钥材料实现类（SecretKeySpec类） </p>
<p><img src="../../images/image-20221221104216617.png" alt=""></p>
<p>比较典型的有两重DES（2DES）、三重DES（3DES）和四重DES（4DES）等几种形式，但在实际应用中一般采用3DES方案，它还有两个别名Triple DES和DESede </p>
<p>对于DESede算法的填充方式，Java 7提供了NoPadding、PKCS5Padding和ISO10126Padding共3种填充方式 </p>
<p><img src="../../images/image-20221221104248236.png" alt=""></p>
<p><img src="../../images/image-20221221104256185.png" alt=""></p>
<h1 id="8-非对称加密算法——高等数据加密"><a href="#8-非对称加密算法——高等数据加密" class="headerlink" title="8. 非对称加密算法——高等数据加密"></a>8. <strong>非对称加密算法——高等数据加密</strong></h1><p>分类 </p>
<ul>
<li><p>基于因子分解难题。RSA算法是最为典型的非对称加密算法，该算法由美国麻省理工学院（MIT）的Ron Rivest、AdiShamir和Leonard Adleman三位学者提出，并以这三位学者的姓氏开头字母命名，称为RSA算法。RSA算法是当今应用范围最为广泛的非对称加密算法，也是第一个既能用于数据加密也能用于数字签名的算法。 </p>
</li>
<li><p>基于离散对数难题。ElGamal算法由Taher ElGamal提出，以自己的名字命名。该算法既可用于加密/解密，也可用于数字签名，并为数字签名算法形成标准提供参考。美国的DSS（Digital Signature Standard，数据签名标准）的DSA（Digital SignatureAlgorithm，数字签名算法）经ElGamal算法演变而来。 </p>
</li>
</ul>
<p>ECC（Elliptical Curve Cryptography，椭圆曲线加密）算法以椭圆曲线理论为基础，在创建密钥时可做到更快、更小，并且更有效。ECC 算法通过椭圆曲线方程式的性质产生密钥，而不是采用传统的方法利用大质数的积来产生。 </p>
<p><img src="../../images/image-20221221104327118.png" alt=""></p>
<p>对于DH算法而言，算法的安全强度在于密钥长度和对称加密算法的选择。 </p>
<ul>
<li><p>DH算法支持的密钥长度为64的倍数位，取值范围在512～1024位（含1024位）之间。密钥长度与加密安全强度成正比，与运算时间成反比。在使用时，需选择合适的密钥长度。 </p>
</li>
<li><p>对称加密算法可以选择DES、DESede和AES算法等</p>
</li>
</ul>
<h1 id="10-数字证书"><a href="#10-数字证书" class="headerlink" title="10. 数字证书"></a>10. <strong>数字证书</strong></h1><p>数字证书集合了多种密码学算法：自身带有公钥信息，可完成相应的加密/解密操作；同时，还带有数字签名，可鉴别消息来源；且自身带有消息摘要信息，可验证证书的完整性；由于证书本身含有用户身份信息，因而具有认证性。 </p>
<p>证书的签发过程实际上是对申请数字证书的公钥做数字签名，证书的验证过程实际上是对数字证书的公钥做验证签名，其中还包含证书有效期验证。 </p>
<p>目前主要有JKS和PEM两种编码格式文件。 </p>
<ul>
<li><p>JKS（Java Key Store），Java原生的密钥库/信任库文件。 </p>
</li>
<li><p>PEM（Privacy Enbanced Mail，隐私增强邮件）是使用多种加密方法提供机密性、认证和信息完整性的因特网电子邮件，在因特网中却没有被广泛配置，但在OpenSSL中，却是最为常见的密钥库文件。 </p>
</li>
</ul>
<p><img src="../../images/image-20221221104402980.png" alt=""></p>
<p><img src="../../images/image-20221221104425339.png" alt=""></p>
<h1 id="11-安全协议"><a href="#11-安全协议" class="headerlink" title="11.安全协议"></a><strong>11.安全协议</strong></h1><p>SSL/TLS协议包含两个协议：SSL和TLS。 </p>
<ul>
<li><p>SSL（Secure Socket Layer，安全套接字层）：由Netscape（网景）公司研发，位于TCP/IP参考模型中的网络传输层，作为为网络通信提供安全及数据完整性的一种安全协议。 </p>
</li>
<li><p>TLS（Transport Layer Security，传输层安全）：基于SSL协议之上的通用化协议，它同样位于TCP/IP参考模型中的网络传输层，作为SSL协议的继任者，成为下一代网络安全性和数据完整性安全协议。详见文档RFC2246（<a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.ietf.org/rfc/rfc2246.txt）。">http://www.ietf.org/rfc/rfc2246.txt）。</a> </p>
</li>
</ul>
<p>SSL/TLS协议可分为两层：记录协议和握手协议。 </p>
<ul>
<li><p>记录协议（Record Protocol）：建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。 </p>
</li>
<li><p>握手协议（Handshake Protocol）：建立在SSL记录协议之上，用于在实际的数据传输开始前，通信双方进行身份认证、协商加密算法、交换加密密钥等。 </p>
</li>
</ul>
<h2 id="协商算法"><a href="#协商算法" class="headerlink" title="协商算法"></a><strong>协商算法</strong></h2><p>服务器端和客户端进行握手协议的第一阶段主要是协商算法 </p>
<p><img src="../../images/image-20221221104513614.png" alt=""></p>
<h2 id="验证证书"><a href="#验证证书" class="headerlink" title="验证证书"></a><strong>验证证书</strong></h2><p>如果服务器端回复客户端时带有其他信息，则进入数字证书验证阶段。服务器端下发服务器证书给客户端后，由客户端验证该证书（见图11-7），主要包含以下几个步骤： </p>
<ol>
<li><p>服务器回复客户端响应时带有服务器证书。 </p>
</li>
<li><p>客户端将该证书发送至认证机构。 </p>
</li>
<li><p>认证机构验证该证书。 </p>
</li>
<li><p>认证机构回应客户端验证结果，如果验证失败将同时得到警告信息 </p>
</li>
</ol>
<p><img src="../../images/image-20221221104539274.png" alt=""></p>
<h2 id="产生密钥"><a href="#产生密钥" class="headerlink" title="产生密钥"></a><strong>产生密钥</strong></h2><p><img src="../../images/image-20221221104558935.png" alt=""></p>
<p><img src="../../images/image-20221221104620876.png" alt=""></p>
<h2 id="加密交互"><a href="#加密交互" class="headerlink" title="加密交互"></a><strong>加密交互</strong></h2><p><img src="../../images/image-20221221104649482.png" alt=""></p>
<p>单向认证，双向认证 </p>
<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-codec/commons-codec --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.bouncycastle/bcprov-jdk15on --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bouncycastle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bcprov-jdk15on<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.64<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<h2 id="jdk-实现"><a href="#jdk-实现" class="headerlink" title="jdk 实现"></a>jdk 实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.daisy.demo.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.*;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.interfaces.DHPublicKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DHParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.RSAPrivateCrtKey;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.RSAPublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.ECGenParameterSpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.InvalidKeySpecException;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.CRC32;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: daisyw</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span>: 2020/1/20 下午3:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrypUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">UTF8</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据转16进制编码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encodeHex</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] data, <span class="keyword">final</span> <span class="type">boolean</span> toLowerCase)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] DIGITS_LOWER = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] DIGITS_UPPER = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] toDigits = toLowerCase ? DIGITS_LOWER : DIGITS_UPPER;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> data.length;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] out = <span class="keyword">new</span> <span class="title class_">char</span>[l &lt;&lt; <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// two characters form the hex value.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, j = <span class="number">0</span>; i &lt; l; i++) &#123;</span><br><span class="line">            out[j++] = toDigits[(<span class="number">0xF0</span> &amp; data[i]) &gt;&gt;&gt; <span class="number">4</span>];</span><br><span class="line">            out[j++] = toDigits[<span class="number">0x0F</span> &amp; data[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(out);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// base64</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64Encode</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Base64.getEncoder().encodeToString(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] base64Decode(<span class="type">byte</span>[] src) &#123;</span><br><span class="line">        <span class="keyword">return</span> Base64.getDecoder().decode(src);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 md5</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = str.getBytes(UTF8);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">digest</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;md5&quot;</span>);</span><br><span class="line">            digest.update(bytes);</span><br><span class="line">            <span class="type">byte</span>[] rsBytes = digest.digest();</span><br><span class="line">            <span class="keyword">return</span> encodeHex(rsBytes, <span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 sha256</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sha256</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> shaBase(<span class="string">&quot;SHA-256&quot;</span>, bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">shaBase</span><span class="params">(String sha, <span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">digest</span> <span class="operator">=</span> MessageDigest.getInstance(sha);</span><br><span class="line">            digest.update(bytes);</span><br><span class="line">            <span class="type">byte</span>[] rsBytes = digest.digest();</span><br><span class="line">            <span class="keyword">return</span> encodeHex(rsBytes, <span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 hmac</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getHmacKey(String type) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">KeyGenerator</span> <span class="variable">keyGenerator</span> <span class="operator">=</span> KeyGenerator.getInstance(type);</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> keyGenerator.generateKey();</span><br><span class="line">            <span class="type">byte</span>[] key = secretKey.getEncoded();</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptHmacSHA256</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> encryptHmacBase(data, getHmacKey(<span class="string">&quot;HmacSHA256&quot;</span>), <span class="string">&quot;HmacSHA256&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptHmacBase</span><span class="params">(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key, String type)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1、还原密钥</span></span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(key, type);</span><br><span class="line">            <span class="comment">// 2、创建MAC对象</span></span><br><span class="line">            <span class="type">Mac</span> <span class="variable">mac</span> <span class="operator">=</span> Mac.getInstance(type);</span><br><span class="line">            <span class="comment">// 3、设置密钥</span></span><br><span class="line">            mac.init(secretKey);</span><br><span class="line">            <span class="comment">// 4、数据加密</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = mac.doFinal(data);</span><br><span class="line">            <span class="comment">// 5、生成数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">rs</span> <span class="operator">=</span> encodeHex(bytes, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span> rs;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 ripemd 参见BC实现</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环冗余校验 CRC 8位16进制字符串</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">crc32</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="type">CRC32</span> <span class="variable">crc32</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CRC32</span>();</span><br><span class="line">        crc32.update(bytes);</span><br><span class="line">        <span class="keyword">return</span> Long.toHexString(crc32.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 DES 密钥长度56位+8位校验位</span></span><br><span class="line">    <span class="comment">// 填充模式</span></span><br><span class="line">    <span class="comment">// NoPadding、PKCS5Padding、ISO10126Padding</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] desEncrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desEncrypt(data, getDesKey(<span class="string">&quot;DES&quot;</span>, <span class="number">56</span>), <span class="string">&quot;DES&quot;</span>, <span class="string">&quot;DES/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] desDecrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desDecrypt(data, getDesKey(<span class="string">&quot;DES&quot;</span>, <span class="number">56</span>), <span class="string">&quot;DES&quot;</span>, <span class="string">&quot;DES/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 3DES 默认密钥长度 168 位</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] desedeEncrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desEncrypt(data, getDesKey(<span class="string">&quot;DES&quot;</span>, <span class="number">168</span>), <span class="string">&quot;DESede&quot;</span>, <span class="string">&quot;DESede/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] desedeDecrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desDecrypt(data, getDesKey(<span class="string">&quot;DES&quot;</span>, <span class="number">168</span>), <span class="string">&quot;DESede&quot;</span>, <span class="string">&quot;DESede/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 AES 默认密钥长度128，192、256 需要获取无政策限制许可</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] aesEncrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desEncrypt(data, getDesKey(<span class="string">&quot;AES&quot;</span>, <span class="number">128</span>), <span class="string">&quot;DESede&quot;</span>, <span class="string">&quot;AES/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] aesDecrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desDecrypt(data, getDesKey(<span class="string">&quot;AES&quot;</span>, <span class="number">128</span>), <span class="string">&quot;DESede&quot;</span>, <span class="string">&quot;AES/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DES base</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getDesKey(String type, <span class="type">int</span> length) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">KeyGenerator</span> <span class="variable">keyGenerator</span> <span class="operator">=</span> KeyGenerator.getInstance(type);</span><br><span class="line">            keyGenerator.init(length);<span class="comment">//java7只提供到56位</span></span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> keyGenerator.generateKey();</span><br><span class="line">            <span class="type">byte</span>[] key = secretKey.getEncoded();</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] desEncrypt(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key, String algorithm, String padding) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(key, algorithm);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(padding);</span><br><span class="line">            cipher.init(Cipher.ENCRYPT_MODE, secretKey);</span><br><span class="line">            <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] desDecrypt(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key, String algorithm, String padding) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(key, algorithm);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(padding);</span><br><span class="line">            cipher.init(Cipher.DECRYPT_MODE, secretKey);</span><br><span class="line">            <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 IDEA 参见BC实现</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 PBE 基于口令加密</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] initSalt() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SecureRandom</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecureRandom</span>();</span><br><span class="line">        <span class="keyword">return</span> random.generateSeed(<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Key <span class="title function_">toKey</span><span class="params">(String password)</span> <span class="keyword">throws</span> NoSuchAlgorithmException, InvalidKeySpecException &#123;</span><br><span class="line">        <span class="type">PBEKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PBEKeySpec</span>(password.toCharArray());</span><br><span class="line">        <span class="type">SecretKeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> SecretKeyFactory.getInstance(<span class="string">&quot;PBEWITHMD5andDES&quot;</span>);</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> keyFactory.generateSecret(keySpec);</span><br><span class="line">        <span class="keyword">return</span> secretKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] encrypt(<span class="type">byte</span>[] data, String password, <span class="type">byte</span>[] salt) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Key</span> <span class="variable">key</span> <span class="operator">=</span> toKey(password);</span><br><span class="line">        <span class="type">PBEParameterSpec</span> <span class="variable">paramSpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PBEParameterSpec</span>(salt, <span class="number">100</span>);<span class="comment">//迭代次数</span></span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;PBEWITHMD5andDES&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, key, paramSpec);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] decrypt(<span class="type">byte</span>[] data, String password, <span class="type">byte</span>[] salt) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Key</span> <span class="variable">key</span> <span class="operator">=</span> toKey(password);</span><br><span class="line">        <span class="type">PBEParameterSpec</span> <span class="variable">paramSpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PBEParameterSpec</span>(salt, <span class="number">100</span>);<span class="comment">//迭代次数</span></span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;PBEWITHMD5andDES&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, key, paramSpec);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非对称加密算法 DH 默认密钥长度是1024,必须是64的倍数，在512到1024位之间</span></span><br><span class="line">    <span class="comment">// -- 本地密钥算法，即对称加密算法。可选des，aes，desede</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECRET_ALGORITHM</span> <span class="operator">=</span> <span class="string">&quot;AES&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -- 初始化甲方密钥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> KeyPair <span class="title function_">initKey</span><span class="params">(<span class="type">int</span> size, String algorithm)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyPairGenerator</span> <span class="variable">keyPairGenerator</span> <span class="operator">=</span> KeyPairGenerator.getInstance(algorithm);</span><br><span class="line">        keyPairGenerator.initialize(size);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.generateKeyPair();</span><br><span class="line">        <span class="keyword">return</span> keyPair;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -- 初始化乙方密钥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> KeyPair <span class="title function_">initKey</span><span class="params">(<span class="type">byte</span>[] key, String algorithm)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//解析甲方的公钥</span></span><br><span class="line">        <span class="comment">//转换公钥的材料</span></span><br><span class="line">        <span class="type">X509EncodedKeySpec</span> <span class="variable">x509KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(key);</span><br><span class="line">        <span class="comment">//实例化密钥工厂</span></span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(algorithm);</span><br><span class="line">        <span class="comment">//产生公钥</span></span><br><span class="line">        <span class="type">PublicKey</span> <span class="variable">pubKey</span> <span class="operator">=</span> keyFactory.generatePublic(x509KeySpec);</span><br><span class="line">        <span class="comment">//由甲方的公钥构造乙方密钥</span></span><br><span class="line">        <span class="type">DHParameterSpec</span> <span class="variable">dhParamSpec</span> <span class="operator">=</span> ((DHPublicKey) pubKey).getParams();</span><br><span class="line">        <span class="comment">//实例化密钥生成器</span></span><br><span class="line">        <span class="type">KeyPairGenerator</span> <span class="variable">keyPairGenerator</span> <span class="operator">=</span> KeyPairGenerator.getInstance(keyFactory.getAlgorithm());</span><br><span class="line">        <span class="comment">//初始化密钥生成器</span></span><br><span class="line">        keyPairGenerator.initialize(dhParamSpec);</span><br><span class="line">        <span class="comment">//产生密钥对</span></span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.genKeyPair();</span><br><span class="line">        <span class="keyword">return</span> keyPair;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getSecretKey(<span class="type">byte</span>[] publicKey, <span class="type">byte</span>[] privateKey, String algorithm) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//实例化密钥工厂</span></span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(algorithm);</span><br><span class="line">        <span class="comment">//初始化公钥</span></span><br><span class="line">        <span class="comment">//密钥材料转换</span></span><br><span class="line">        <span class="type">X509EncodedKeySpec</span> <span class="variable">x509KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(publicKey);</span><br><span class="line">        <span class="comment">//产生公钥</span></span><br><span class="line">        <span class="type">PublicKey</span> <span class="variable">pubKey</span> <span class="operator">=</span> keyFactory.generatePublic(x509KeySpec);</span><br><span class="line">        <span class="comment">//初始化私钥</span></span><br><span class="line">        <span class="comment">//密钥材料转换</span></span><br><span class="line">        <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">pkcs8KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(privateKey);</span><br><span class="line">        <span class="comment">//产生私钥</span></span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">priKey</span> <span class="operator">=</span> keyFactory.generatePrivate(pkcs8KeySpec);</span><br><span class="line">        <span class="comment">//实例化</span></span><br><span class="line">        <span class="type">KeyAgreement</span> <span class="variable">keyAgree</span> <span class="operator">=</span> KeyAgreement.getInstance(keyFactory.getAlgorithm());</span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        keyAgree.init(priKey);</span><br><span class="line">        keyAgree.doPhase(pubKey, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//生成本地密钥</span></span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> keyAgree.generateSecret(SECRET_ALGORITHM);</span><br><span class="line">        <span class="keyword">return</span> secretKey.getEncoded();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testDH</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//甲方密钥</span></span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair1</span> <span class="operator">=</span> initKey(<span class="number">512</span>, <span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] publicKey1 = keyPair1.getPublic().getEncoded();</span><br><span class="line">        <span class="type">byte</span>[] privateKey1 = keyPair1.getPrivate().getEncoded();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//由甲方的公钥产生的密钥对，乙方使用</span></span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair2</span> <span class="operator">=</span> initKey(publicKey1, <span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] publicKey2 = keyPair2.getPublic().getEncoded();</span><br><span class="line">        <span class="type">byte</span>[] privateKey2 = keyPair2.getPrivate().getEncoded();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//组装甲方的本地加密密钥,由乙方的公钥和甲方的私钥组合而成</span></span><br><span class="line">        <span class="type">byte</span>[] key1 = getSecretKey(publicKey2, privateKey1, <span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;甲方的本地密钥：/n&quot;</span> + Base64.getEncoder().encodeToString(key1));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//组装乙方的本地加密密钥，由甲方的公钥和乙方的私钥组合而成</span></span><br><span class="line">        <span class="type">byte</span>[] key2 = getSecretKey(publicKey1, privateKey2, <span class="string">&quot;DH&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;乙方的本地密钥：/n&quot;</span> + Base64.getEncoder().encodeToString(key2));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非对称加密 ECDH</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非对称加密 RSA 1024位密钥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] encryptRsa(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">            <span class="type">X509EncodedKeySpec</span> <span class="variable">x509KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(key);</span><br><span class="line">            <span class="type">RSAPublicKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> (RSAPublicKey) keyFactory.generatePublic(x509KeySpec);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">            cipher.init(Cipher.PUBLIC_KEY, secretKey);</span><br><span class="line">            <span class="type">byte</span>[] rs = cipher.doFinal(data);</span><br><span class="line">            <span class="keyword">return</span> rs;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] decryptRsa(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">            <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(key);</span><br><span class="line">            <span class="type">RSAPrivateCrtKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> (RSAPrivateCrtKey) keyFactory.generatePrivate(keySpec);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">            cipher.init(Cipher.PRIVATE_KEY, secretKey);</span><br><span class="line">            <span class="type">byte</span>[] rs = cipher.doFinal(data);</span><br><span class="line">            <span class="keyword">return</span> rs;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testRSA</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;java小工匠&quot;</span>;</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> initKey(<span class="number">1024</span>, <span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] secretData = encryptRsa(str.getBytes(), keyPair.getPublic().getEncoded());</span><br><span class="line">        System.out.println(<span class="string">&quot;RSA加密:&quot;</span> + encodeHex(secretData, <span class="literal">true</span>));</span><br><span class="line">        <span class="type">byte</span>[] data = decryptRsa(secretData, keyPair.getPrivate().getEncoded());</span><br><span class="line">        System.out.println(<span class="string">&quot;RSA解密:&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非对称加密 EIGamal 参见BC实现</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数字签名 DSA</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 签名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] sign(<span class="type">byte</span>[] data, <span class="type">byte</span>[] privateKey, String type, String algorithm) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 还原使用</span></span><br><span class="line">            <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">pkcs8EncodedKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(privateKey);</span><br><span class="line">            <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(algorithm);</span><br><span class="line">            <span class="type">PrivateKey</span> <span class="variable">priKey</span> <span class="operator">=</span> keyFactory.generatePrivate(pkcs8EncodedKeySpec);</span><br><span class="line">            <span class="comment">// 1、实例化Signature</span></span><br><span class="line">            <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> Signature.getInstance(type);</span><br><span class="line">            <span class="comment">// 2、初始化Signature</span></span><br><span class="line">            signature.initSign(priKey);</span><br><span class="line">            <span class="comment">// 3、更新数据</span></span><br><span class="line">            signature.update(data);</span><br><span class="line">            <span class="comment">// 4、签名</span></span><br><span class="line">            <span class="keyword">return</span> signature.sign();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(<span class="type">byte</span>[] data, <span class="type">byte</span>[] publicKey, <span class="type">byte</span>[] sign, String type, String algorithm)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">X509EncodedKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(publicKey);</span><br><span class="line">            <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(algorithm);</span><br><span class="line">            <span class="type">PublicKey</span> <span class="variable">pubKey</span> <span class="operator">=</span> keyFactory.generatePublic(keySpec);</span><br><span class="line">            <span class="comment">// 1、实例化Signature</span></span><br><span class="line">            <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> Signature.getInstance(type);</span><br><span class="line">            <span class="comment">// 2、初始化Signature</span></span><br><span class="line">            signature.initVerify(pubKey);</span><br><span class="line">            <span class="comment">// 3、更新数据</span></span><br><span class="line">            signature.update(data);</span><br><span class="line">            <span class="comment">// 4、签名</span></span><br><span class="line">            <span class="keyword">return</span> signature.verify(sign);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDSAsign</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;java小工匠&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] data = str.getBytes();</span><br><span class="line">        <span class="comment">// 初始化密钥度</span></span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> initKey(<span class="number">1024</span>, <span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] publicKey = keyPair.getPublic().getEncoded();</span><br><span class="line">        <span class="type">byte</span>[] privateKey = keyPair.getPrivate().getEncoded();</span><br><span class="line">        <span class="comment">// 签名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;SHAwithDSA&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] sign = sign(str.getBytes(), privateKey, type, <span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        <span class="comment">// 验证</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> verify(data, publicKey, sign, type, <span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;验证:&quot;</span> + b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数字签名 RSA</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRSAsign</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;java小工匠&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] data = str.getBytes();</span><br><span class="line">        <span class="comment">// 初始化密钥度</span></span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> initKey(<span class="number">1024</span>, <span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] publicKey = keyPair.getPublic().getEncoded();</span><br><span class="line">        <span class="type">byte</span>[] privateKey = keyPair.getPrivate().getEncoded();</span><br><span class="line">        <span class="comment">// 签名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;MD5withRSA&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] sign = sign(str.getBytes(), privateKey, type, <span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="comment">// 验证</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> verify(data, publicKey, sign, type, <span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;验证:&quot;</span> + b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数字签名 ECDSA</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化密钥对</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> KeyPair <span class="title function_">initKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">KeyPairGenerator</span> <span class="variable">generator</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;EC&quot;</span>);</span><br><span class="line">            <span class="type">ECGenParameterSpec</span> <span class="variable">ecGenParameterSpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ECGenParameterSpec</span>(<span class="string">&quot;secp256k1&quot;</span>);</span><br><span class="line">            generator.initialize(ecGenParameterSpec, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">            generator.initialize(<span class="number">256</span>);</span><br><span class="line">            <span class="keyword">return</span> generator.generateKeyPair();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testECDSA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;java小工匠&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] data = str.getBytes();</span><br><span class="line">        <span class="comment">// 初始化密钥度</span></span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> initKey();</span><br><span class="line">        <span class="type">byte</span>[] publicKey = keyPair.getPublic().getEncoded();</span><br><span class="line">        <span class="type">byte</span>[] privateKey = keyPair.getPrivate().getEncoded();</span><br><span class="line">        <span class="comment">// 签名</span></span><br><span class="line">        <span class="type">byte</span>[] sign = sign(str.getBytes(), privateKey, <span class="string">&quot;SHA256withECDSA&quot;</span>, <span class="string">&quot;EC&quot;</span>);</span><br><span class="line">        <span class="comment">// 验证</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> verify(data, publicKey, sign, <span class="string">&quot;SHA256withECDSA&quot;</span>, <span class="string">&quot;EC&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;验证:&quot;</span> + b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="bouncycastle实现"><a href="#bouncycastle实现" class="headerlink" title="bouncycastle实现"></a>bouncycastle实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.daisy.demo.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.CipherParameters;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.digests.MD5Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.digests.RIPEMD256Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.digests.SHA256Digest;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.macs.HMac;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.crypto.params.KeyParameter;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.util.encoders.Base64;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.util.encoders.Hex;</span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.util.encoders.UrlBase64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Mac;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.DHParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: daisyw</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span>: 2020/1/20 下午5:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrypBC</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">UTF8</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// base64 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64Encode</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Base64.toBase64String(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] base64Decode(<span class="type">byte</span>[] src) &#123;</span><br><span class="line">        <span class="keyword">return</span> Base64.decode(src);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64EncodeToURLSafeString</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(UrlBase64.encode(data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 md5 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = str.getBytes(UTF8);</span><br><span class="line">        <span class="type">Digest</span> <span class="variable">digest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MD5Digest</span>();</span><br><span class="line">        digest.update(data, <span class="number">0</span>, data.length);</span><br><span class="line">        <span class="type">byte</span>[] rsData = <span class="keyword">new</span> <span class="title class_">byte</span>[digest.getDigestSize()];</span><br><span class="line">        digest.doFinal(rsData, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> Hex.toHexString(rsData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 sha256 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sha256</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="type">Digest</span> <span class="variable">digest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SHA256Digest</span>();</span><br><span class="line">        digest.update(bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        <span class="type">byte</span>[] rsData = <span class="keyword">new</span> <span class="title class_">byte</span>[digest.getDigestSize()];</span><br><span class="line">        digest.doFinal(rsData, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> Hex.toHexString(rsData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 hmac </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getHmacSha256Key() &#123;</span><br><span class="line">        <span class="keyword">return</span> CrypUtil.getHmacKey(<span class="string">&quot;HmacSHA256&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptHmacSHA256</span><span class="params">(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key)</span> &#123;</span><br><span class="line">        <span class="type">HMac</span> <span class="variable">hmac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HMac</span>(<span class="keyword">new</span> <span class="title class_">SHA256Digest</span>());</span><br><span class="line">        hmac.init(<span class="keyword">new</span> <span class="title class_">KeyParameter</span>(key));</span><br><span class="line">        hmac.update(data, <span class="number">0</span>, data.length);</span><br><span class="line">        <span class="type">byte</span>[] rsData = <span class="keyword">new</span> <span class="title class_">byte</span>[hmac.getMacSize()];</span><br><span class="line">        hmac.doFinal(rsData, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> Hex.toHexString(rsData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 ripemd </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">ripemd256</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="type">Digest</span> <span class="variable">digest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RIPEMD256Digest</span>();</span><br><span class="line">        digest.update(bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">        <span class="type">byte</span>[] rsData = <span class="keyword">new</span> <span class="title class_">byte</span>[digest.getDigestSize()];</span><br><span class="line">        digest.doFinal(rsData, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> Hex.toHexString(rsData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 DES 密钥长度56位+8位校验位 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] desEncrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desEncrypt(data, getDesKey(<span class="string">&quot;DES&quot;</span>, <span class="number">56</span>), <span class="string">&quot;DES&quot;</span>, <span class="string">&quot;DES/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] desDecrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desDecrypt(data, getDesKey(<span class="string">&quot;DES&quot;</span>, <span class="number">56</span>), <span class="string">&quot;DES&quot;</span>, <span class="string">&quot;DES/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 3DES 默认密钥长度 168 位 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] desedeEncrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desEncrypt(data, getDesKey(<span class="string">&quot;DES&quot;</span>, <span class="number">168</span>), <span class="string">&quot;DESede&quot;</span>, <span class="string">&quot;DESede/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] desedeDecrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desDecrypt(data, getDesKey(<span class="string">&quot;DES&quot;</span>, <span class="number">168</span>), <span class="string">&quot;DESede&quot;</span>, <span class="string">&quot;DESede/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 AES 默认密钥长度128，192、256 需要获取无政策限制许可 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] aesEncrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desEncrypt(data, getDesKey(<span class="string">&quot;AES&quot;</span>, <span class="number">128</span>), <span class="string">&quot;DESede&quot;</span>, <span class="string">&quot;AES/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] aesDecrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desDecrypt(data, getDesKey(<span class="string">&quot;AES&quot;</span>, <span class="number">128</span>), <span class="string">&quot;DESede&quot;</span>, <span class="string">&quot;AES/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DES base </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getDesKey(String type, <span class="type">int</span> length) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Security.addProvider(<span class="keyword">new</span> <span class="title class_">BouncyCastleProvider</span>());</span><br><span class="line">            <span class="type">KeyGenerator</span> <span class="variable">keyGenerator</span> <span class="operator">=</span> KeyGenerator.getInstance(type, <span class="string">&quot;BC&quot;</span>);</span><br><span class="line">            keyGenerator.init(length);<span class="comment">////BC可以又64位密钥 </span></span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> keyGenerator.generateKey();</span><br><span class="line">            <span class="keyword">return</span> secretKey.getEncoded();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] desEncrypt(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key, String algorithm, String padding) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Security.addProvider(<span class="keyword">new</span> <span class="title class_">BouncyCastleProvider</span>());</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(key, algorithm);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(padding);</span><br><span class="line">            cipher.init(Cipher.ENCRYPT_MODE, secretKey);</span><br><span class="line">            <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] desDecrypt(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key, String algorithm, String padding) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Security.addProvider(<span class="keyword">new</span> <span class="title class_">BouncyCastleProvider</span>());</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(key, algorithm);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(padding);</span><br><span class="line">            cipher.init(Cipher.DECRYPT_MODE, secretKey);</span><br><span class="line">            <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 IDEA 密钥长度128 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] ideaEncrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desEncrypt(data, getDesKey(<span class="string">&quot;IDEA&quot;</span>, <span class="number">128</span>), <span class="string">&quot;IDEA&quot;</span>, <span class="string">&quot;IDEA/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] ideaDecrypty(<span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> desDecrypt(data, getDesKey(<span class="string">&quot;IDEA&quot;</span>, <span class="number">128</span>), <span class="string">&quot;IDEA&quot;</span>, <span class="string">&quot;IDEA/ECB/ISO10126Padding&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 PBE 参见java实现 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非对称加密 RSA 参见java实现 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非对称加密 EIGamal </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> KeyPair <span class="title function_">initKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 加入对BouncyCastle支持 </span></span><br><span class="line">            Security.addProvider(<span class="keyword">new</span> <span class="title class_">BouncyCastleProvider</span>());</span><br><span class="line">            <span class="comment">// 初始化参数生成器 </span></span><br><span class="line">            <span class="type">AlgorithmParameterGenerator</span> <span class="variable">apg</span> <span class="operator">=</span> AlgorithmParameterGenerator.getInstance(<span class="string">&quot;ElGamal&quot;</span>, <span class="string">&quot;BC&quot;</span>);</span><br><span class="line">            apg.init(<span class="number">256</span>);</span><br><span class="line">            <span class="comment">// 生成算法参数 </span></span><br><span class="line">            <span class="type">AlgorithmParameters</span> <span class="variable">params</span> <span class="operator">=</span> apg.generateParameters();</span><br><span class="line">            <span class="comment">// 构建参数 </span></span><br><span class="line">            <span class="type">DHParameterSpec</span> <span class="variable">elParams</span> <span class="operator">=</span> (DHParameterSpec) params.getParameterSpec(DHParameterSpec.class);</span><br><span class="line">            <span class="comment">// 实例化密钥生成器 </span></span><br><span class="line">            <span class="type">KeyPairGenerator</span> <span class="variable">kpg</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;ElGamal&quot;</span>);</span><br><span class="line">            <span class="comment">// 初始化密钥对生成器 </span></span><br><span class="line">            kpg.initialize(elParams, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">            <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> kpg.generateKeyPair();</span><br><span class="line"><span class="comment">//            keyPair.getPrivate().getEncoded(); </span></span><br><span class="line"><span class="comment">//            keyPair.getPublic().getEncoded(); </span></span><br><span class="line">            <span class="keyword">return</span> keyPair;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 公钥加密 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] encrypt(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> <span class="title class_">BouncyCastleProvider</span>());</span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;ElGamal&quot;</span>);</span><br><span class="line">        <span class="type">X509EncodedKeySpec</span> <span class="variable">x509KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(key);</span><br><span class="line">        <span class="type">PublicKey</span> <span class="variable">pubKey</span> <span class="operator">=</span> keyFactory.generatePublic(x509KeySpec);</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;ElGamal&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, pubKey);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私钥解密 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] decrypt(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> <span class="title class_">BouncyCastleProvider</span>());</span><br><span class="line">        <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">pkcs8KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(key);</span><br><span class="line">        <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(<span class="string">&quot;ElGamal&quot;</span>);</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> keyFactory.generatePrivate(pkcs8KeySpec);</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;ElGamal&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h2 id="commons-codec-实现"><a href="#commons-codec-实现" class="headerlink" title="commons.codec 实现"></a>commons.codec 实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.daisy.demo.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Hex;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.HmacAlgorithms;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.HmacUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Mac;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: daisyw</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span>: 2020/1/20 下午5:35 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrypCC</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">UTF8</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SI</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">EI</span> <span class="operator">=</span> <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// base64 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64Encode</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Base64.encodeBase64String(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] base64Decode(<span class="type">byte</span>[] src) &#123;</span><br><span class="line">        <span class="keyword">return</span> Base64.decodeBase64(src);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  -- CC base64编码，编码长度超过76个字符,添加\r\n 字符进行换行 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64EncodeToChunkedStr</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.encodeBase64(data, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> StringUtils.newStringUsAscii(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  -- 使用&#x27;-&#x27; 和 &#x27;_&#x27; 下划线替换Base64 编码中的 &#x27;+&#x27; 和 &#x27;/&#x27;,解决 URL传输问题 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64EncodeToURLSafeString</span><span class="params">(<span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Base64.encodeBase64URLSafeString(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 md5 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DigestUtils.md5Hex(str.getBytes(UTF8));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5L16</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> md5(str).substring(SI,EI);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 sha256 </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sha256</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DigestUtils.sha256Hex(bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 hmac </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getHmacSha256Key() &#123;</span><br><span class="line">        <span class="keyword">return</span> CrypUtil.getHmacKey(<span class="string">&quot;HmacSHA256&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptHmacSHA256</span><span class="params">(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key)</span> &#123;</span><br><span class="line">        <span class="type">Mac</span> <span class="variable">mac</span> <span class="operator">=</span> HmacUtils.getInitializedMac(HmacAlgorithms.HMAC_SHA_256, key);</span><br><span class="line">        <span class="keyword">return</span> Hex.encodeHexString(mac.doFinal(data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息摘要算法 ripemd 参见BC实现 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 DES 密钥长度56位+8位校验位 暂无 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 AES 暂无 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 IDEA 参见BC实现 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对称加密算法 PBE 参见java实现 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非对称加密 RSA 参见java实现 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 非对称加密 EIGamal 参见BC实现 </span></span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://starskydata.com">Daisy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://starskydata.com/posts/28372.html">http://starskydata.com/posts/28372.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java%E5%9F%BA%E7%A1%80/">java基础</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/42467.html" title="Data Analyst"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Data Analyst</div></div></a></div><div class="next-post pull-right"><a href="/posts/40684.html" title="分治、排序、搜索和随机算法Week2"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">分治、排序、搜索和随机算法Week2</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/35230.html" title="ArrayList"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-13</div><div class="title">ArrayList</div></div></a></div><div><a href="/posts/54605.html" title="字节码插桩"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-17</div><div class="title">字节码插桩</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Daisy</div><div class="author-info__description">分享计算机相关，旅行，美妆，一个平凡人的生活点滴</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8"><span class="toc-number">1.</span> <span class="toc-text">1. 企业应用安全</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%AF%86%E7%A0%81%E5%AD%A6"><span class="toc-number">2.</span> <span class="toc-text">2. 密码学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%AD%A6%E5%88%86%E7%B1%BB"><span class="toc-number">2.1.</span> <span class="toc-text">密码学分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E5%AF%86%E7%A0%81%E5%AD%A6"><span class="toc-number">2.2.</span> <span class="toc-text">各种密码学</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-java%E5%8A%A0%E5%AF%86"><span class="toc-number">3.</span> <span class="toc-text">3. java加密</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#java-security%E5%8C%85"><span class="toc-number">3.1.</span> <span class="toc-text">java.security包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-crypto%E5%8C%85"><span class="toc-number">3.2.</span> <span class="toc-text">java.crypto包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-security-spec%E5%8C%85%E5%92%8Cjavax-crypto-spec%E5%8C%85"><span class="toc-number">3.3.</span> <span class="toc-text">java.security.spec包和javax.crypto.spec包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-security-cert%E5%8C%85"><span class="toc-number">3.4.</span> <span class="toc-text">java.security.cert包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#javax-net-ssl%E5%8C%85"><span class="toc-number">3.5.</span> <span class="toc-text">javax.net.ssl包</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7"><span class="toc-number">4.</span> <span class="toc-text">4. 辅助工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Base64-%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E4%BC%A0%E8%BE%93%E7%AE%97%E6%B3%95"><span class="toc-number">5.</span> <span class="toc-text">5. Base64-电子邮件传输算法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95%E2%80%94%E2%80%94%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">6.</span> <span class="toc-text">6. 消息摘要算法——验证数据完整性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E2%80%94%E2%80%94%E5%88%9D%E7%AD%89%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86"><span class="toc-number">7.</span> <span class="toc-text">7. 对称加密算法——初等数据加密</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E2%80%94%E2%80%94%E9%AB%98%E7%AD%89%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86"><span class="toc-number">8.</span> <span class="toc-text">8. 非对称加密算法——高等数据加密</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6"><span class="toc-number">9.</span> <span class="toc-text">10. 数字证书</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE"><span class="toc-number">10.</span> <span class="toc-text">11.安全协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E5%95%86%E7%AE%97%E6%B3%95"><span class="toc-number">10.1.</span> <span class="toc-text">协商算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E8%AF%81%E4%B9%A6"><span class="toc-number">10.2.</span> <span class="toc-text">验证证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E5%AF%86%E9%92%A5"><span class="toc-number">10.3.</span> <span class="toc-text">产生密钥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E4%BA%A4%E4%BA%92"><span class="toc-number">10.4.</span> <span class="toc-text">加密交互</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Code"><span class="toc-number">11.</span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pom"><span class="toc-number">11.1.</span> <span class="toc-text">pom</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jdk-%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.2.</span> <span class="toc-text">jdk 实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bouncycastle%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.3.</span> <span class="toc-text">bouncycastle实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#commons-codec-%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.4.</span> <span class="toc-text">commons.codec 实现</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/19528.html" title="SQL 基础">SQL 基础</a><time datetime="2023-07-17T12:20:53.000Z" title="Created 2023-07-17 16:20:53">2023-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/53592.html" title="数据库系统">数据库系统</a><time datetime="2023-07-17T12:20:53.000Z" title="Created 2023-07-17 16:20:53">2023-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/6358.html" title="Mysql (一)">Mysql (一)</a><time datetime="2023-07-17T12:20:53.000Z" title="Created 2023-07-17 16:20:53">2023-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/18640.html" title="Mysql (三)">Mysql (三)</a><time datetime="2023-07-17T12:20:53.000Z" title="Created 2023-07-17 16:20:53">2023-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/55410.html" title="Mysql (二)">Mysql (二)</a><time datetime="2023-07-17T12:20:53.000Z" title="Created 2023-07-17 16:20:53">2023-07-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/pink.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Daisy</div><div class="footer_custom_text">Hi, welcome to Daisy's blog.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'drak' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '86359bb4e81712c59c38',
      clientSecret: '513930a00de8718c7c1fab2fe09128ec5ef94042',
      repo: 'DaisyW92.github.io',
      owner: 'DaisyW92',
      admin: ['DaisyW92'],
      id: '596ac1577645607f75df2054bf57e298',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.textContent= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>